<ion-content class="background">

  <!-- ðŸ›ï¸ CabeÃ§alho -->
  <div class="cart-header">
    <h2><ion-icon name="cart-outline"></ion-icon> Meu Carrinho</h2>
  </div>

  <!-- ðŸ“¦ Lista de produtos -->
  <div class="cart-container fade-in" *ngIf="carrinho.length > 0; else vazio">
    <div class="cart-item" *ngFor="let item of carrinho; let i = index">
      <img [src]="item.imagem" alt="{{ item.nome }}" class="cart-image" />
      
      <div class="cart-info">
        <h3>{{ item.nome }}</h3>
        <p>R$ {{ item.preco | number: '1.2-2' }}</p>

        <!-- âœ… CONTROLES DE QUANTIDADE (NOVO) -->
        <div class="quantity-controls">
          <button class="qty-btn" (click)="diminuirQuantidade(item)">-</button>
          <span class="qty-value">{{ item.quantidade }}</span>
          <button class="qty-btn" (click)="aumentarQuantidade(item)">+</button>
        </div>

      </div>

      <ion-icon
        name="trash-outline"
        class="remove-btn"
        (click)="removerItem(i)"
      ></ion-icon>
    </div>

    <div class="total">
      <p><strong>Total:</strong> R$ {{ total | number: '1.2-2' }}</p>
    </div>

    <!-- ðŸ’³ Formas de pagamento -->
    <div class="payment-options">
      <h4>Forma de pagamento</h4>
      <ion-radio-group [(ngModel)]="formaPagamento">
        <ion-item lines="none">
          <ion-radio slot="start" value="pix"></ion-radio>
          <ion-label>Pix</ion-label>
        </ion-item>
        <ion-item lines="none">
          <ion-radio slot="start" value="cartao"></ion-radio>
          <ion-label>CartÃ£o de CrÃ©dito / DÃ©bito</ion-label>
        </ion-item>
        <ion-item lines="none">
          <ion-radio slot="start" value="entrega"></ion-radio>
          <ion-label>Pagar na Entrega</ion-label>
        </ion-item>
      </ion-radio-group>

      <!-- ðŸ”‘ PIX selecionado -> mostrar chave PIX -->
      <div class="pix-info fade-in" *ngIf="formaPagamento === 'pix'">
        <p class="pix-label">
          <strong>Chave PIX:</strong> rkconfeitaria@gmail.com
        </p>
        <button class="copiar-btn" (click)="copiarPix()">
          Copiar chave PIX
        </button>
      </div>

      <!-- ðŸ’µ Dinheiro / pagar na entrega -> troco -->
      <div class="troco-info fade-in" *ngIf="formaPagamento === 'entrega'">
        <label class="troco-label">Troco para:</label>
        <input
          type="number"
          class="troco-input"
          placeholder="Informe o valor (ex: 50,00)"
          [(ngModel)]="valorTroco"
        />
      </div>

      <!-- ðŸ” Campos do cartÃ£o -->
      <div class="card-form fade-in" *ngIf="formaPagamento === 'cartao'">
        <h5>Dados do cartÃ£o </h5>

        <div class="card-field">
          <label>NÃºmero do cartÃ£o</label>
          <input
            type="text"
            maxlength="19"
            [(ngModel)]="cartao.numero"
            placeholder="1234 5678 9012 3456"
          />
        </div>

        <div class="card-field">
          <label>Nome impresso no cartÃ£o</label>
          <input
            type="text"
            [(ngModel)]="cartao.nome"
            placeholder="Nome do titular"
          />
        </div>

        <div class="card-field-row">
          <div class="card-field">
            <label>Validade</label>
            <input
              type="text"
              maxlength="5"
              [(ngModel)]="cartao.validade"
              placeholder="MM/AA"
            />
          </div>

          <div class="card-field">
            <label>CVV</label>
            <input
              type="password"
              maxlength="4"
              [(ngModel)]="cartao.cvv"
              placeholder="123"
            />
          </div>
        </div>

        <p class="card-hint">Apenas para testes, nenhum dado real serÃ¡ cobrado ðŸ’š</p>
      </div>
    </div>

    <!-- ðŸ  EndereÃ§o de entrega (NOVO) -->
    <div class="address-box">
      <h4>EndereÃ§o de entrega</h4>

      <div class="address-field">
        <label>Rua</label>
        <input
          type="text"
          [(ngModel)]="endereco.rua"
          placeholder="Ex: Rua das Flores"
        />
      </div>

      <div class="address-row">
        <div class="address-field">
          <label>NÃºmero</label>
          <input
            type="text"
            [(ngModel)]="endereco.numero"
            placeholder="123"
          />
        </div>

        <div class="address-field">
          <label>Bairro</label>
          <input
            type="text"
            [(ngModel)]="endereco.bairro"
            placeholder="Centro"
          />
        </div>
      </div>

      <div class="address-field">
        <label>Ponto de referÃªncia (opcional)</label>
        <input
          type="text"
          [(ngModel)]="endereco.complemento"
          placeholder="Perto da praÃ§a, portÃ£o azul..."
        />
      </div>
    </div>

    <button class="finalizar-btn" (click)="finalizarCompra()">
      Finalizar Compra
    </button>
  </div>

  <!-- ðŸ§ Carrinho vazio -->
  <ng-template #vazio>
    <div class="empty-cart fade-in">
      <ion-icon name="cart-outline"></ion-icon>
      <p>Seu carrinho estÃ¡ vazio ðŸ˜¢</p>
      <button class="btn-voltar" (click)="navegar('/menu')">
        Voltar ao Menu
      </button>
    </div>
  </ng-template>

  <!-- ðŸ§¾ Modal de confirmaÃ§Ã£o -->
  <div class="modal-overlay" *ngIf="mostrarResumo">
    <div class="modal-content fade-in">
      <ion-icon name="checkmark-circle-outline" class="icon-sucesso"></ion-icon>
      <h3>Compra Finalizada ðŸŽ‰</h3>
      <p>Pedido nÂº <strong>{{ numeroPedido }}</strong></p>
      <p>Forma de pagamento: <strong>{{ formaPagamento | uppercase }}</strong></p>
      <p class="agradecimento">Obrigada por escolher a RK Confeitaria ðŸ’š</p>
      <button class="btn-voltar-menu" (click)="voltarMenu()">Voltar ao Menu</button>
    </div>
  </div>
</ion-content>

<!-- Footer -->
<ion-footer class="footer-nav">
  <div class="nav-buttons">
    <button
      class="nav-btn"
      [class.active]="rotaAtiva === '/menu'"
      (click)="navegar('/menu')"
    >
      <ion-icon name="restaurant-outline"></ion-icon>
      <span>Menu</span>
    </button>

    <button
      class="nav-btn"
      [class.active]="rotaAtiva === '/carrinho'"
      (click)="navegar('/carrinho')"
    >
      <ion-icon name="cart-outline"></ion-icon>
      <span>Carrinho</span>
    </button>

    <button
      class="nav-btn"
      [class.active]="rotaAtiva === '/perfil'"
      (click)="navegar('/perfil')"
    >
      <ion-icon name="person-outline"></ion-icon>
      <span>Perfil</span>
    </button>
  </div>
</ion-footer>
